---
title: "Reproducible Figures Assignment"
output:
  html_document: default
  pdf_document: default
date: "2023-11-29"
---

# Installing and loading packages

```{r echo=FALSE}
library(tidyverse)
library(palmerpenguins)
library(janitor)
library(here)
library(ggplot2)
library(patchwork)
library(ragg)
library(svglite)

source(here("functions","cleaning_penguin_data.r"))
```

# Data Preparation:

```{r echo=FALSE}
#Preserving and loading raw data.

write.csv(penguins_raw, here("data","penguins_raw.csv"))
penguins_data_raw<-read.csv(here("data","penguins_raw.csv"))


#Investigating data

head(penguins_data_raw)
colnames(penguins_data_raw)


#Cleaning raw data to generate a cleaner dataset.

cleaning_penguin_columns <- function(raw_data){
    raw_data %>% 
    clean_names() %>% 
    shorten_species() %>% 
      remove_empty(c("rows", "cols")) %>% 
      select(-starts_with("delta")) %>% 
      select(-comments)}
      
colnames(penguins_data_raw)
penguins_data_clean<-cleaning_penguin_columns(penguins_data_raw)
colnames(penguins_data_clean)

#writes new csv for clean penguins data. 
write.csv(penguins_data_clean, here("data","penguins_data_clean.csv"))
penguins_data_clean <- read.csv(here("data", "penguins_data_clean.csv"))
```

## QUESTION 1: Data Visualisation for Science Communication

### a) Create a figure using the Palmer Penguin dataset that is correct but badly communicates the data. Do not make a boxplot.

```{r bad figure code, echo=FALSE}
bad_bargraph_island_png<-ggplot(penguins_data_clean) + geom_col(aes(x=island, y=body_mass_g))

ggplot(penguins_data_clean) + geom_col(aes(x=island, y=body_mass_g))

agg_png("figures/bad_bargraph_island_bodymass.png", 
        width = 20,
        height = 20,
        units = "cm",
        res = 200,
        scaling = 0.5)

print(bad_bargraph_island_png)
dev.off()
```

### b) Write about how your design choices mislead the reader about the underlying data (200-300 words). Include references.

My graph is correct but some design choices mislead the reader.

Firstly, there is no information about each data point, such as the species of penguin each sample is a member of. This is misleading; penguin species is likely a confounding variable which impacts penguin size and the island(s) inhabited. This therefore may mislead a reader as the effects of different species are not explicitly shown, so a misleading correlation may be represented on my graph. 

The lack of error bars is also misleading as it is unclear to a reader how much measurements for a certain treatment (in this case each island) vary. Therefore, it is unclear whether the samples taken from each island are representative of the population on each island or whether there is wide variation and improper sampling, or whether the data are precise and/or accurate.

On this graph, I also only show a summary of the data, in this case maximum body mass in each category (i.e on each island). This is misleading because important information may be hidden. For example, the maximum body mass for each island might be an outlier. This is also represented in the axis labels, which do not state maximum body mass but instead state only "body_mass_g". 

Moreover, axis labels as specified in the .png plot are also very small, making it hard for a reader to understand what the graph is showing. Readers must look very closely at the axis labels to see the variables being compared. This is misleading because by not clearly showing your axis labels and any units associated with them, readers are more likely to miss key details about exactly what is being compared or what relationship is suggested by a graph between, which may cause them to believe a false correlation is present.


## Question 2

### Introduction

In this analysis, I am aiming to assess whether clutch completion and body mass are correlated in penguins, and whether the minimum body mass required for clutch completion differs significantly between the Adelie, Chinstrap and Gentoo penguin species.

```{r Data Exploration- taken from lesson materials provided by Lydia France, University of Oxford, 2024}
#All packages used can be found at the top of the document.
library(palmerpenguins)

#These lines of code preserve raw data in a separate csv file so it is not lost and can be easily recovered.
write.csv(penguins_raw, here("data","penguins_raw.csv"))
penguins_data_raw<-read.csv(here("data","penguins_raw.csv"))


#Investigating data- allows initial analysis of what data were collected and what values have been recorded for each.

head(penguins_data_raw)
colnames(penguins_data_raw)


#Cleaning raw data to generate a cleaner dataset- removing superfluous variables and making data more easily read by R. 

cleaning_penguin_columns <- function(raw_data){
    raw_data %>% 
    clean_names() %>% 
    shorten_species() %>% 
      remove_empty(c("rows", "cols")) %>% 
      select(-starts_with("delta")) %>% 
      select(-comments)}

#Checking that the above code has worked.
colnames(penguins_data_raw)
penguins_data_clean<-cleaning_penguin_columns(penguins_data_raw)
colnames(penguins_data_clean)

#Writing new .csv file for new, clean dataset to keep this safe in case any accidental changes are made or code breaks, to allow code to be easily recovered. 
write.csv(penguins_data_clean, here("data","penguins_data_clean.csv"))
penguins_data_clean <- read.csv(here("data", "penguins_data_clean.csv"))

#Setting colour-blind friendly colour pallette to distinguish data relating to different species.
species_colours <- c("Adelie" = "darkorange", "Chinstrap" = "purple4", "Gentoo" = "darkgreen")

#Making function to create datasets only containing information on species, clutch completion, body mass and sex.
refining_penguins_data <- function(clean_data){
  clean_data %>% 
  select(species, body_mass_g, clutch_completion, sex) %>% 
  remove_NA()
}

#Making new, refined dataset
penguins_data_refined <- refining_penguins_data(penguins_data_clean)
write.csv(penguins_data_refined, here("data", "penguins_data_refined.csv"))
penguins_data_refined <- read.csv(here("data","penguins_data_refined.csv"))

#Filtering for body mass based on different species to ensure normal distribution in each species.
adelie_data <- penguins_data_clean %>%
  filter(species == "Adelie") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

chinstrap_data <- penguins_data_clean %>%
  filter(species == "Chinstrap") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

gentoo_data <- penguins_data_clean %>%
  filter(species == "Gentoo") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

adelie_data_male <- penguins_data_clean %>%
  filter(species == "Adelie", sex == "MALE") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

chinstrap_data_male <- penguins_data_clean %>%
  filter(species == "Chinstrap", sex == "MALE") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

gentoo_data_male <- penguins_data_clean %>%
  filter(species == "Gentoo", sex == "MALE") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

adelie_data_female <- penguins_data_clean %>%
  filter(species == "Adelie", sex == "FEMALE") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

chinstrap_data_female <- penguins_data_clean %>%
  filter(species == "Chinstrap", sex == "FEMALE") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

gentoo_data_female <- penguins_data_clean %>%
  filter(species == "Gentoo", sex == "FEMALE") %>%
  select(species, body_mass_g, clutch_completion) %>%
  remove_NA()

#Plotting histogram to ensure data follows normal distribution
ggplot(data = penguins_data_clean, aes(x=body_mass_g)) + geom_histogram(aes(color=species))
ggplot(data = adelie_data, aes(x=body_mass_g)) + geom_histogram(aes(color=species))
ggplot(data = chinstrap_data, aes(x=body_mass_g)) + geom_histogram(aes(color=species))
ggplot(data = gentoo_data, aes(x=body_mass_g)) + geom_histogram(aes(color=species))

#Transforming body mass data using log10 and square root to attempt to make data more normally distributed - unsuccessful.
ggplot(data = adelie_data, aes(x=body_mass_g)) + geom_histogram(aes(color=species))
ggplot(data = adelie_data, aes(x=body_mass_g)) + geom_histogram() + scale_x_log10()
ggplot(data = adelie_data, aes(x=body_mass_g)) + geom_histogram() + scale_x_sqrt()

ggplot(data = chinstrap_data, aes(x=body_mass_g)) + geom_histogram(aes(color=species))
ggplot(data = chinstrap_data, aes(x=body_mass_g)) + geom_histogram() + scale_x_log10()
ggplot(data = chinstrap_data, aes(x=body_mass_g)) + geom_histogram() + scale_x_sqrt()

ggplot(data = gentoo_data, aes(x=body_mass_g)) + geom_histogram(aes(color=species))
ggplot(data = gentoo_data, aes(x=body_mass_g)) + geom_histogram() + scale_x_log10()
ggplot(data = gentoo_data, aes(x=body_mass_g)) + geom_histogram() + scale_x_sqrt()

#Plotting a violin chart to explore whether body mass can explain successful clutch completion.
ggplot(data=penguins_data_clean, aes (x=body_mass_g, y=clutch_completion)) + geom_violin(aes(color=species)) + scale_color_manual(values = species_colours) + labs (x= "Body mass (g)", y = "Clutch completion") + theme_bw() + stat_summary(species="mean", geom="point", color="black")

#Plotting violin charts for each species to explore relationship between body mass and clutch completion in each species individually.
ggplot(data=adelie_data, aes (x=body_mass_g, y=clutch_completion)) + geom_violin(aes(color=species)) + scale_color_manual(values = species_colours) + labs (x= "Body mass (g)", y = "Clutch completion") + theme_bw() + stat_summary(species="mean", geom="pointrange", color="black")

ggplot(data=chinstrap_data, aes (x=body_mass_g, y=clutch_completion)) + geom_violin(aes(color=species)) + scale_color_manual(values = species_colours) + labs (x= "Body mass (g)", y = "Clutch completion") + theme_bw() + stat_summary(species="mean", geom="pointrange", color="black")

ggplot(data=gentoo_data, aes (x=body_mass_g, y=clutch_completion)) + geom_violin(aes(color=species)) + scale_color_manual(values = species_colours) + labs (x= "Body mass (g)", y = "Clutch completion") + theme_bw() + stat_summary(species="mean", geom="pointrange", color="black")
```

### Hypothesis

My first null hypothesis is that there is no correlation between body mass and clutch completion in any penguin species.
My second null hypothesis is that there are no significant differences between species as to whether body mass informs clutch completion. 

My first alternative hypothesis is that there is a significant correlation between body mass and clutch completion in any penguin species.
My second alternative hypothesis is that there are significant effects of species on the relationship between body mass and clutch completion.


### Statistical Methods

```{r Statistics}

# Make sure your code prints. 

```

### Results & Discussion

```{r Plotting Results}

# Make sure your code prints. 

```

### Conclusion

*You will be marked on the following:*

a)  Your code for readability and functionality
b)  Your figures for communication
c)  Your text communication of your analysis

## QUESTION 3: Open Science

### a) GitHub

*Upload your RProject you created for **Question 2** and any files and subfolders used to GitHub. Do not include any identifiers such as your name. Make sure your GitHub repo is public.*

*GitHub link:*

*You will be marked on your repo organisation and readability.*

### b) Share your repo with a partner, download, and try to run their data pipeline.

*Partner's GitHub link:*

*You **must** provide this so I can verify there is no plagiarism between you and your partner.*

### c) Reflect on your experience running their code. (300-500 words)

-   *What elements of your partner's code helped you to understand their data pipeline?*

-   *Did it run? Did you need to fix anything?*

-   *What suggestions would you make for improving their code to make it more understandable or reproducible, and why?*

-   *If you needed to alter your partner's figure using their code, do you think that would be easy or difficult, and why?*

### d) Reflect on your own code based on your experience with your partner's code and their review of yours. (300-500 words)

-   *What improvements did they suggest, and do you agree?*

-   *What did you learn about writing code for other people?*
